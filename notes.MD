# Заметки


## Функционирование сервиса MeetingRoom

### Создание комнаты
Хозяин группы создает новую комнату: Контроллер создаёт новый объект `MeetingRoom`. Генерируются токены пользователя и админа и ссылки для входа.

### Работа комнаты
Пользователь идёт по ссылке входа `/room?token=xxxx`. Контролер комнаты выполняет аутентификацию:
- активна ли комната с указанным токеном
- если у пользователя нет куки с личным токеном, перенаправить на страницу регистрации нового гостя
- если гость идентифицирован, выводится страница комнаты
- если личный токен гостя уже зарегистрирован в другой комнате, то выводится сообщение о том, что посетитель может присутствовать лишь на одной встрече. Далее предлагается удалиться из активной встречи или же перейти в неё.
- если гость заходит на страницу повторно, но по ссылке другого статуса, то его статус в базе данных приводится в соответствие с последним статусом входа (например, гость был создан как админ, но затем по какой-то причине зашел по ссылке для обычных посетителей - его статус меняется на статус обычного гостя, и он попадает на соответствующую страницу)


## Функционирование сервиса Guest
Сервис **Guest** отвечает за взаимодействие с гостями, участвующими во встречах. Гости не имеют постоянной регистрации, и данные о них должны быть удалены из базы после окончания работы комнаты встреч.


### регистрация нового гостя
Пользователь вводит имя в поле формы, которая отправляется по ссылке вида `/room/signup?name=<guestName>&token=xxxx`, которую обрабатывает контроллер гостей. Проводится аутентификация токена комнаты. Если комната активна, создается новый объект `Guest` (если токен xxxx является токеном админа, то устанавливается флаг isAdmin). Генерируется remember token, который сохраняется пользователю в куки. Далее пользователь перенаправляется вновь по ссылке входа.