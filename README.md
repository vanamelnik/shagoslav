# Шагослав

> -- Папа, мне кажется, ты любишь шаги больше, чем нас, твоих детей!
> -- Это не так, Шагослав!

__Шагослав__ - это веб-сервис для проведения онлайн конференций групп выздоравливающих, проходящих двенадцатишаговую программу.

## Основное
Данный веб-сервис позволяет пользователям объединяться в анонимные группы и проводить онлайн встречи в изолированных "комнатах". В начальной реализации комната будет обеспечивать участников таймером и материалами, необходимыми для проведения встречи. В дальнейшем планируется аудио и видео онлайн конференции.

## Структура сайта
- Главная страница
- Страница управления группой (личный кабинет)
- Страница встречи

### Главная страница
На главной странице должна быть размещена ссылка для входа в лчиный кабинет группв и для создания новых групп. Больше я пока не знаю, что разместить... Возможно, новости сервиса, общее число групп, информация по открытым группам и поиск по ним. Возможно, послания от лица групп всем остальным (что-то вроде стены). Ссылки на регистрацию новых групп и вход в личный кабинет. Возможно, ссылка на общие материалы сервиса.

### Личный кабинет группы
Для регистрации новой группы необходимо ввести действующий email и пароль. Группа должна иметь уникальное название. Администратору предоставляется доступ в личный кабинет группы.
В личном кабинете можно задавать настройки а также сохранять материалы, необходимые для проведения встреч. Ещё можно увидеть информацию о прошедших встречах и планировать следующие мероприятия
##### Настройки в личном кабинете:
- открытая или закрытая группа
- смена названия, пароля или адреса эл. почты
- удаление группы
- добавление материалов, используемых на встречах

Информация об открытых группах и их встречах видна на главной странице и отображается в поиске. В закрытые группы можно попасть по ссылке.
Для удаления группы дается 30-дневный срок на раздумие. В течение этого срока в личном кабинете будет отображаться предупреждающая надпись, сообщающая количество оставшихся дней и предложения отменить удаление. Если администратор не отменил действие, по прошествии 30 дней информация о группе и все её материалы полностью удаляются из базы данных.
##### Информация о прошедших встречах
##### Управление конференцией
Администратор нажатием на кнопку "Создать новую встречу" (_комнату???_) получает админскую ссылку на новую встречу. Также он получает ссылку, по которой на встречу попадают остальные участники. В параметрах можно:
- указать время начала и время окончания (если пользователи приходят раньше времени начала, то попадают в "зону ожидания")
- сформировать шаблон экрана встречи
- возможно задать подтверждение для каждого присоединяющегося участника

### Страница встречи
На встрече есть два типа пользователей - обычные участники и администратор(_-ы?_)
При переходе по ссылке у пользователя запрашивается его имя, которое будет отображаться на странице встречи. Поскольку сообщество подразумевает анонимность, регистрация участников не проводится, каждый может называть себя, как пожелает.
На странице встречи должна отображаться следующая информация:
- общий таймер встречи
- часы (_нужны ли они? м.б. опционально_)
- количество участников на встрече
- имена участников, которые они указали при переходе по ссылке (у администратора(-ов?) отображается соответствующий значок)
- таймер высказывания (устанавливается и запускается администратором)
- окно материалов, в котором отображаются необходимые материалы (размещаются администратором)
- чат (_нужен или нет?_)

#### Страница встречи (админская)
У администратора должна быть возможность:
- устанавливать таймер высказывания
- отмечать высказавшихся участников
- удалять участников из комнаты
- управлять материалами, отображаемыми в окне материалов
- заканчивать встречу (после окончания комната закрывается, доступ блокируется)

#### Материалы группы
Поскольку многие сообщества пользуются одинаковыми текстами, для экономии места на дисках сервера можно предоставлять группам материалы в виде виртуальных копий. Также каждая группа может хранить собственные материалы, под которые выделяется какое-то количество дискового пространства. Материалы могут быть следующих типов:
- текст
- ссылка на встроенное видео YouTube
- ~~текст в формате Word~~
- ~~аудио~~



## Внутренняя структура сервиса

### Packages
#### shagoslav
В пакете `shagoslav` содержатся контроллеры, обрабатывающие http-обращения к сервису:
- `MeetingRoomsController`
- `GuestController`
- `GroupController`

Также в пакете сформулированы интерфейсы:
- `MeetingRoomService` - операции с объектами встреч в БД
- `GuestService` - операции с гостями в БД

#### database
Пакет `database` реализует интерфейсы взаимодействия с базой данных `Postgresql`. В нём имплементированы интерфейсы `MeetingRoomService` и `GuestService`

#### rand
Вспомогательный пакет для генерации случайных токенов.

#### cmd
Исполняемый файл, в котором объединяются все зависимости.

### Routes
Сервер обслуживает следующие пути:
- `/` - главная страница
- `/login` - вход в личный кабинет группы
- `/signup` - регистрация новой группы
- `/group` - личный кабинет группы с идентификатором xx
- `/meeting?token=xxxx` - страница встречи. Если xxxx является верным токеном администратора, то отображается страница администратора встречи
- `/meeting/newguest?token=xxxx` - вывод формы регистрации нового гостя на встрече xxxx
- `/meeting/signup?token=xxxx&name=<name>` - создание нового гостя на встрече с токеном xxxx

### Базы данных

Для баз данных используется postgres

#### Таблица групп
БД --`groups`-- -информация о зарегистрированных группах. Имеет следующие поля:
- id
- создана
- название
- email
- pasword_hash
- --закрытая/открытая--
- remember token администратора

#### Таблица встреч
БД `rooms` - информация о встречах. Нужна для хранения токена администратора. После завершения записи удаляются.
- id
- group_id
- name
- created_at
- start_time
- admin_token
- guest_token

##### Таблица гостей
- id (используется только как счётчик, в полях структуры не отображается)
- remember_token
- room_id
- указанное имя
- created_at
- is_admin